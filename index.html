<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>История Анри (Магический Гримуар)</title>
    <link href="https://fonts.googleapis.com/css2?family=Cinzel:wght@700&family=Cinzel+Decorative:wght@900&display=swap" rel="stylesheet">
    
    <style>
        :root {
            --scarlet-dark: #3a0000;
            --scarlet-main: #7c0a02;
            --gold-dark: #8a6e2f;
            --gold-main: #d4af37;
        }

        body {
            background-color: #0a0505;
            background-image: url('https://www.transparenttextures.com/patterns/black-felt.png'), linear-gradient(to bottom, #1a1a1a, #0a0505);
            background-blend-mode: overlay;
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            height: 100vh;
            margin: 0;
            overflow: hidden;
            font-family: 'Cinzel', serif;
            color: var(--gold-main);
        }

        /* УПРАВЛЕНИЕ */
        .controls {
            position: fixed;
            bottom: 30px;
            z-index: 1000;
            display: flex;
            gap: 20px;
            background: rgba(58, 0, 0, 0.9);
            padding: 15px 30px;
            border-radius: 10px;
            border: 3px solid var(--gold-dark);
            box-shadow: 0 10px 30px rgba(0,0,0,0.9), inset 0 0 20px rgba(212, 175, 55, 0.2);
        }

        .btn {
            background: linear-gradient(to bottom, var(--scarlet-main), var(--scarlet-dark));
            border: 2px solid var(--gold-main);
            color: var(--gold-main);
            padding: 12px 24px;
            border-radius: 5px;
            cursor: pointer;
            font-family: 'Cinzel', serif;
            font-weight: bold;
            text-transform: uppercase;
            letter-spacing: 1px;
            text-shadow: 1px 1px 2px #000;
            box-shadow: 0 4px 0 var(--scarlet-dark), 0 4px 10px rgba(0,0,0,0.5);
            transition: 0.2s;
        }

        .btn:hover { transform: translateY(2px); box-shadow: 0 2px 0 var(--scarlet-dark); background: var(--scarlet-main); }
        .btn:active { transform: translateY(4px); box-shadow: none; }
        .zoom-btn { font-size: 22px; padding: 10px 20px; }

        /* КОНТЕЙНЕР КНИГИ */
        #book-zoom-wrapper {
            transition: transform 0.5s cubic-bezier(0.25, 0.8, 0.25, 1);
            transform-origin: center center;
            padding: 50px;
            filter: drop-shadow(0 20px 40px rgba(0,0,0,0.8));
        }

        /* СТРАНИЦЫ */
        .page {
            background-color: #f0e2c5;
            background-image: url('https://www.transparenttextures.com/patterns/cream-paper.png');
            box-shadow: inset 0 0 30px rgba(61, 43, 5, 0.2);
            overflow: hidden;
        }
        .page img { width: 100%; height: 100%; object-fit: cover; filter: sepia(0.2) contrast(1.1); }

        /* ОБЛОЖКИ */
        .cover-design {
            background: url('https://www.transparenttextures.com/patterns/dark-leather.png'), linear-gradient(135deg, var(--scarlet-main) 0%, var(--scarlet-dark) 80%);
            background-blend-mode: multiply;
            height: 100%; display: flex; justify-content: center; align-items: center; position: relative; overflow: hidden;
            border: 12px solid #2b0505;
            box-shadow: inset 0 0 100px rgba(0,0,0,0.9), inset 0 0 20px var(--scarlet-dark);
        }
        .cover-front { box-shadow: inset 30px 0 40px -10px rgba(255, 200, 200, 0.15), inset 0 0 100px rgba(0,0,0,0.9); border-left-width: 25px; }
        .cover-back { box-shadow: inset -30px 0 40px -10px rgba(255, 200, 200, 0.15), inset 0 0 100px rgba(0,0,0,0.9); border-right-width: 25px; }

        /* ДЕКОР */
        .magic-bg-runes {
            position: absolute; top: 0; left: 0; width: 100%; height: 100%;
            font-family: 'Cinzel Decorative', cursive; font-size: 150px; color: var(--gold-main);
            opacity: 0.07; display: flex; flex-wrap: wrap; justify-content: center; align-content: center;
            letter-spacing: 20px; line-height: 1.5; pointer-events: none;
        }
        .cover-border {
            border: 5px double var(--gold-main); outline: 3px solid var(--gold-dark); outline-offset: -15px;
            width: 75%; height: 82%; display: flex; flex-direction: column; justify-content: center; align-items: center;
            text-align: center; padding: 20px; position: relative; background: rgba(58, 0, 0, 0.3);
            box-shadow: 0 0 30px rgba(0,0,0,0.5); z-index: 2;
        }
        .corner-decoration { position: absolute; font-family: 'Cinzel Decorative', cursive; font-size: 60px; color: var(--gold-main); opacity: 0.8; }
        .corner-tl { top: -25px; left: -25px; }
        .corner-tr { top: -25px; right: -25px; transform: scaleX(-1); }
        .corner-bl { bottom: -25px; left: -25px; transform: scaleY(-1); }
        .corner-br { bottom: -25px; right: -25px; transform: scale(-1, -1); }
        .cover-title {
            font-size: 42px; font-weight: 900; background: linear-gradient(to bottom, var(--gold-main), var(--gold-dark));
            -webkit-background-clip: text; -webkit-text-fill-color: transparent; text-shadow: 0px 2px 4px rgba(0,0,0,0.8);
            margin-bottom: 30px; letter-spacing: 3px; line-height: 1.3; text-transform: uppercase;
        }
        .cover-icon { font-size: 60px; color: var(--gold-main); text-shadow: 0 0 20px var(--gold-main), 0 5px 10px black; margin: 20px 0; }
        
        /* Статус загрузки */
        #status-msg {
            position: fixed; top: 50%; left: 50%; transform: translate(-50%, -50%);
            color: var(--gold-main); font-size: 24px; text-shadow: 0 0 10px black;
            background: rgba(0,0,0,0.8); padding: 20px; border-radius: 10px; border: 1px solid var(--gold-dark);
            z-index: 2000;
        }
    </style>
</head>
<body>

    <div id="status-msg">Связь с библиотекой GitHub...</div>

    <div id="book-zoom-wrapper">
        <div id="book"></div>
    </div>

    <div class="controls">
        <button class="btn zoom-btn" onclick="zoom(-0.1)">-</button>
        <button class="btn zoom-btn" onclick="zoom(0.1)">+</button>
    </div>

    <script src="https://unpkg.com/page-flip/dist/js/page-flip.browser.js"></script>

    <script>
        // ============================================
        // НАСТРОЙКИ (УЖЕ ВПИСАЛ ТВОИ)
        // ============================================
        const USERNAME = "anri-sila007";
        const REPO_NAME = "comic_anri";
        // ============================================

        const bookDiv = document.getElementById('book');
        const wrapper = document.getElementById('book-zoom-wrapper');
        const statusMsg = document.getElementById('status-msg');
        let pageFlip;
        let currentScale = 0.85;

        wrapper.style.transform = `scale(${currentScale})`;

        function zoom(delta) {
            currentScale += delta;
            if (currentScale < 0.4) currentScale = 0.4;
            if (currentScale > 2.0) currentScale = 2.0;
            wrapper.style.transform = `scale(${currentScale})`;
        }

        // --- АВТОМАТИЧЕСКАЯ ЗАГРУЗКА ИЗ GITHUB ---
        async function initBook() {
            const apiUrl = `https://api.github.com/repos/${USERNAME}/${REPO_NAME}/contents`;

            try {
                const response = await fetch(apiUrl);
                if (!response.ok) throw new Error("Не могу найти репозиторий");
                
                const data = await response.json();
                
                // Фильтруем только картинки
                const imageFiles = data.filter(file => 
                    file.name.match(/\.(jpg|jpeg|png|gif|webp)$/i)
                );

                if (imageFiles.length === 0) {
                    statusMsg.innerText = "В папке нет картинок! Загрузи их через Upload files.";
                    return;
                }

                // Сортируем картинки по имени (1.jpg, 2.jpg...)
                imageFiles.sort((a, b) => a.name.localeCompare(b.name, undefined, {numeric: true, sensitivity: 'base'}));

                statusMsg.innerText = `Найдено страниц: ${imageFiles.length}. Создаю книгу...`;
                
                // Очищаем и строим HTML
                bookDiv.innerHTML = '';
                
                // 1. ПЕРЕДНЯЯ ОБЛОЖКА
                addPage('hard', `
                    <div class="cover-design cover-front">
                        <div class="magic-bg-runes">A B C D E F G H I J K L M</div>
                        <div class="cover-border">
                            <div class="corner-decoration corner-tl">c</div>
                            <div class="corner-decoration corner-tr">c</div>
                            <div class="corner-decoration corner-bl">c</div>
                            <div class="corner-decoration corner-br">c</div>
                            <div class="cover-icon">⚡</div>
                            <div class="cover-title">ИСТОРИЯ АНРИ<br>О ФУТБОЛЕ</div>
                            <div class="cover-icon">⚽</div>
                        </div>
                    </div>
                `);
                
                addPage('hard', '<div style="width:100%; height:100%; background-color:#f0e2c5; background-image: url(https://www.transparenttextures.com/patterns/cream-paper.png); box-shadow: inset 0 0 50px rgba(61, 43, 5, 0.4);"></div>');

                // 2. СТРАНИЦЫ ИЗ GITHUB
                imageFiles.forEach(file => {
                    addPage('soft', `<img src="${file.download_url}" loading="lazy">`);
                });

                if (imageFiles.length % 2 !== 0) {
                     addPage('soft', '<div style="width:100%; height:100%; background-color:#f0e2c5; background-image: url(https://www.transparenttextures.com/patterns/cream-paper.png);"></div>');
                }

                addPage('hard', '<div style="width:100%; height:100%; background-color:#f0e2c5; background-image: url(https://www.transparenttextures.com/patterns/cream-paper.png); box-shadow: inset 0 0 50px rgba(61, 43, 5, 0.4);"></div>');

                // 3. ЗАДНЯЯ ОБЛОЖКА
                addPage('hard', `
                    <div class="cover-design cover-back">
                        <div class="magic-bg-runes">Z Y X W V U T S R Q P O N</div>
                        <div class="cover-border" style="height: 40%;">
                            <div class="corner-decoration corner-tl">c</div>
                            <div class="corner-decoration corner-tr">c</div>
                            <div class="corner-decoration corner-bl">c</div>
                            <div class="corner-decoration corner-br">c</div>
                            <div style="margin-top: auto; margin-bottom: auto; font-size: 28px; color: var(--gold-main);">КОНЕЦ ТОМА I</div>
                        </div>
                    </div>
                `);

                // 4. ЗАПУСК БИБЛИОТЕКИ
                pageFlip = new St.PageFlip(bookDiv, {
                    width: 450, height: 650, size: 'fixed',
                    minWidth: 300, maxWidth: 1000, minHeight: 400, maxHeight: 1500,
                    showCover: true, usePortrait: false, maxShadowOpacity: 0.9
                });

                pageFlip.loadFromHTML(document.querySelectorAll('.page'));
                
                // Скрываем загрузку
                statusMsg.style.display = 'none';

            } catch (err) {
                statusMsg.innerText = "Ошибка: " + err.message;
                statusMsg.style.color = 'red';
            }
        }

        function addPage(density, html) {
            const div = document.createElement('div');
            div.classList.add('page');
            if (density === 'hard') {
                div.classList.add('--hard');
                div.setAttribute('data-density', 'hard');
            }
            div.innerHTML = html;
            bookDiv.appendChild(div);
        }

        // Старт
        initBook();

    </script>
</body>
</html>
